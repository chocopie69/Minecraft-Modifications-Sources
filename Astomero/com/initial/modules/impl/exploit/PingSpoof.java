package com.initial.modules.impl.exploit;

import com.initial.settings.impl.*;
import java.util.*;
import net.minecraft.network.*;
import com.initial.utils.player.*;
import com.initial.modules.*;
import com.initial.settings.*;
import net.minecraft.network.play.client.*;
import com.initial.events.*;
import com.initial.events.impl.*;
import com.initial.utils.network.*;

public class PingSpoof extends Module
{
    public DoubleSet pingval;
    private static final ArrayList<Packet> packets;
    private Packet sendPacket;
    private final TimerHelper timer;
    
    public PingSpoof() {
        super("PingSpoof", 0, Category.EXPLOIT);
        this.pingval = new DoubleSet("Packets Delay", 350.0, 100.0, 5000.0, 50.0);
        this.sendPacket = null;
        this.timer = new TimerHelper();
        this.setArrayName("Ping Spoof");
        this.addSettings(this.pingval);
    }
    
    @EventTarget
    public void onSend(final EventSendPacket e) {
        if (this.sendPacket != null && e.getPacket() instanceof C00PacketKeepAlive && e.getPacket() == this.sendPacket) {
            this.sendPacket = null;
        }
        else if (e.getPacket() instanceof C00PacketKeepAlive) {
            PingSpoof.packets.add(e.packet);
            e.setCancelled(true);
        }
    }
    
    @EventTarget
    public void onTick(final EventTick e) {
        this.setDisplayName("Ping Spoof §7" + String.valueOf(this.pingval.getValue()));
        if (this.timer.hasTimeElapsed((long)this.pingval.getValue(), true) && PingSpoof.packets.size() >= 1) {
            this.sendPacket = PingSpoof.packets.get(0);
            PacketUtil.sendPacket(PingSpoof.packets.get(0));
            PingSpoof.packets.remove(0);
        }
    }
    
    static {
        packets = new ArrayList<Packet>();
    }
}
